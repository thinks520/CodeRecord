#!/usr/bin/python
#coding:utf-8

import requests
import winsound
import win32com.client
import time

# 说明
## 监测网站状态
## 如果网站已经无法访问发出警告


switch_of_proxy=raw_input('Do You Need to set up an agent? If you need,please Input yes|YES,otherwise no|NO : ')
if switch_of_proxy == 'yes' or switch_of_proxy == 'YES':
	host_port=raw_input('Please Input The proxy host and port,like proxy.cmcc:8080  : ')
	proxy={'http':host_port,'https':host_port}
else:
	proxy=None
#proxy={'http':'proxy.cmcc:8080','https':'proxy.cmcc:8080'}


while True:
	speak=win32com.client.Dispatch('SAPI.SPVOICE')
	targetfile=open('target.txt','rb')
	Downtarget=open('down.txt','w+')

	for target in targetfile:
		target=target.strip('\r\n')
		target=target.strip('\r\n')
		if target.startswith('http'):
			pass
		else:
			target='http://'+target
		try:	
			r=requests.get(target,proxies=proxy,verify=False)
			print target
			print r.status_code
			status=r.status_code
			if str(status).startswith('3') or str(status).startswith('4') or str(status).startswith('5'):
				print 'The Target May Be Down, Please Check it'
				speak.Speak('Target May be down')
				Downtarget.writelines(target+'\n')
				Downtarget.flush()
			#print '%s site status is %s' %` (target,r.status_code)
		except requests.exceptions.ConnectionError:
			print 'The Target IS down'
			winsound.Beep(2015,3000)
			speak.Speak('Target is down,Target is down')
			Downtarget.writelines(target+'\n')
			Downtarget.flush()
	targetfile.close()
	Downtarget.close()
	time.sleep(3600)
